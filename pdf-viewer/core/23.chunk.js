(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{452:function(t,e,n){n.r(e);var i=n(1),a=n(10),o=n(2);t=n(51);var r=n(34),s=n(11);n=function(){function t(){this.init()}return t.prototype.init=function(){this.i6=!1,this.Ve=this.rl=this.connection=null,this.Wr={},this.la=this.dF=null},t.prototype.Nla=function(t){for(var e=this,n=0;n<t.length;++n){var i=t[n];switch(i.at){case"create":this.Wr[i.author]||(this.Wr[i.author]=i.aName),this.Tca(i);break;case"modify":this.la.Ul(i.xfdf).then((function(t){e.la.qb(t[0])}));break;case"delete":this.la.Ul("<delete><id>"+i.aId+"</id></delete>")}}},t.prototype.Tca=function(t){var e=this;this.la.Ul(t.xfdf).then((function(n){(n=n[0]).authorId=t.author,e.la.qb(n),e.la.trigger(a.b.UPDATE_ANNOTATION_PERMISSION,[n])}))},t.prototype.sca=function(t,e,n){this.rl&&this.rl(t,e,n)},t.prototype.preloadAnnotations=function(t){this.addEventListener("webViewerServerAnnotationsEnabled",this.sca.bind(this,t,"add",{imported:!1}),{once:!0})},t.prototype.initiateCollaboration=function(e,n,i){var s=this;if(e){s.Ve=n,s.la=i.ta(),i.addEventListener(a.e.DOCUMENT_UNLOADED,(function(){s.disableCollaboration()})),s.lma(e);var l=new XMLHttpRequest;l.addEventListener("load",(function(){if(200===l.status&&0<l.responseText.length)try{var n=JSON.parse(l.responseText);s.connection=exports.Ya.Qma(Object(r.j)(s.Ve,"blackbox/"),"annot"),s.dF=n.id,s.Wr[n.id]=n.user_name,s.la.eM(n.id),s.connection.mqa((function(t){t.t&&t.t.startsWith("a_")&&t.data&&s.Nla(t.data)}),(function(){s.connection.send({t:"a_retrieve",dId:e}),s.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[s.Wr[n.id],s.dF])}),(function(){s.disableCollaboration()}))}catch(t){Object(o.g)(t.message)}})),l.open("GET",Object(r.j)(this.Ve,"demo/SessionInfo.jsp")),l.withCredentials=!0,l.send(),s.i6=!0,s.la.yY((function(t){return s.Wr[t.Author]||t.Author}))}else Object(o.g)("Document ID required for collaboration")},t.prototype.disableCollaboration=function(){this.rl&&(this.la.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.rl),this.rl=null),this.connection&&this.connection.Np(),this.la&&this.la.eM("Guest"),this.init(),this.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)},t.prototype.lma=function(t){var e=this;this.rl&&this.la.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.rl),this.rl=function(n,a,o){return Object(i.b)(this,void 0,void 0,(function(){var r,s,l,d,h,c,u,E,f;return Object(i.d)(this,(function(i){switch(i.label){case 0:return o.imported?[2]:(r={t:"a_"+a,dId:t,annots:[]},[4,e.la.mI()]);case 1:for(s=i.ea(),"delete"!==a&&(l=(new DOMParser).parseFromString(s,"text/xml"),d=new XMLSerializer),h=0;h<n.length;h++)c=n[h],E=u=void 0,"add"===a?(u=l.querySelector('[name="'+c.Id+'"]'),E=d.serializeToString(u),f=null,c.InReplyTo&&(f=e.la.hg(c.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:c.Id,author:e.dF,aName:e.Wr[e.dF],parent:f,xfdf:"<add>"+E+"</add>"})):"modify"===a?(u=l.querySelector('[name="'+c.Id+'"]'),E=d.serializeToString(u),r.annots.push({at:"modify",aId:c.Id,xfdf:"<modify>"+E+"</modify>"})):"delete"===a&&r.annots.push({at:"delete",aId:c.Id});return 0<r.annots.length&&e.connection.send(r),[2]}}))}))}.bind(e),this.la.addEventListener(s.a.Events.ANNOTATION_CHANGED,this.rl)},t.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"},t}(),Object(t.a)(n),e.default=n}}])}).call(this||window);